import{J as f,M as h,Ya as p,c as g,h as n,k as c,p as o}from"./chunk-4K6JBKNM.js";var x=(()=>{class a{constructor(e){this.supabase=e,this.articlesSubject=new g([]),this.articles$=this.articlesSubject.asObservable(),this.loadArticles()}loadArticles(){this.getArticles().subscribe(e=>{this.articlesSubject.next(e)})}getArticles(){return n(this.supabase.client.from("articles").select("*").order("created_at",{ascending:!1})).pipe(c(({data:e,error:t})=>t?(console.error("Error fetching articles:",t),console.log("Check your Supabase configuration in .env file"),[]):(e||[]).map(this.mapSupabaseToArticle)),o(e=>(console.error("Network error in getArticles:",e),console.log("This might be a CORS issue or incorrect Supabase URL"),[])))}getArticleBySlug(e){return n(this.supabase.client.from("articles").select("*").eq("slug",e).single()).pipe(c(({data:t,error:r})=>{if(r){console.error("Error fetching article by slug:",r);return}return t?this.mapSupabaseToArticle(t):void 0}),o(t=>(console.error("Error in getArticleBySlug:",t),[void 0])))}addArticle(e){let t={title:e.title,slug:e.slug,content:e.content,excerpt:e.excerpt,author:e.author,categories:e.categories,tags:e.tags,reading_time:e.readingTime,featured:e.featured};return n(this.supabase.client.from("articles").insert(t).select().single()).pipe(c(({data:r,error:i})=>{if(i)throw console.error("Error adding article:",i),i;let s=r?this.mapSupabaseToArticle(r):null;if(s){let l=this.articlesSubject.value;this.articlesSubject.next([s,...l])}return s}),o(r=>{throw console.error("Error in addArticle:",r),r}))}updateArticle(e,t){let r={};return t.title&&(r.title=t.title),t.slug&&(r.slug=t.slug),t.content&&(r.content=t.content),t.excerpt&&(r.excerpt=t.excerpt),t.author&&(r.author=t.author),t.categories&&(r.categories=t.categories),t.tags&&(r.tags=t.tags),t.readingTime&&(r.reading_time=t.readingTime),t.featured!==void 0&&(r.featured=t.featured),r.updated_at=new Date().toISOString(),n(this.supabase.client.from("articles").update(r).eq("id",e).select().single()).pipe(c(({data:i,error:s})=>{if(s)throw console.error("Error updating article:",s),s;let l=i?this.mapSupabaseToArticle(i):null;if(l){let b=this.articlesSubject.value.map(u=>u.id===e?l:u);this.articlesSubject.next(b)}return l}),o(i=>{throw console.error("Error in updateArticle:",i),i}))}deleteArticle(e){return n(this.supabase.client.from("articles").delete().eq("id",e)).pipe(c(({error:t})=>{if(t)throw console.error("Error deleting article:",t),t;let i=this.articlesSubject.value.filter(s=>s.id!==e);return this.articlesSubject.next(i),!0}),o(t=>{throw console.error("Error in deleteArticle:",t),t}))}mapSupabaseToArticle(e){return{id:e.id,title:e.title,slug:e.slug,content:e.content,excerpt:e.excerpt,author:e.author,categories:e.categories||[],tags:e.tags||[],createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at),readingTime:e.reading_time,featured:e.featured}}static{this.\u0275fac=function(t){return new(t||a)(h(p))}}static{this.\u0275prov=f({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();export{x as a};
